<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>WhitePack Catalogue</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root {
      --bg:#f3faf4;
      --card:#ffffff;
      --accent:#2f9e44;
      --accent-light:#d9f2de;
      --text:#0f172a;
      --muted:#64748b;
      --danger:#ef4444;
    }
    body { margin:0; background:var(--bg); font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }
    header {
      background:#fff;
      position:sticky;
      top:0;
      z-index:10;
      padding:.5rem .8rem;
      box-shadow:0 4px 20px rgba(0,0,0,.04);
      display:flex;
      gap:.5rem;
      align-items:center;
    }
    header h1 { font-size:1rem; margin:0; color:var(--text); flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    input[type=search], select {
      border:1px solid #e2e8f0;
      border-radius:.6rem;
      padding:.35rem .6rem;
      font-size:.85rem;
      background:#fff;
    }
    #langBtn {
      border:none; background:var(--accent); color:#fff;
      border-radius:.6rem; padding:.35rem .6rem; cursor:pointer; font-size:.75rem; font-weight:600;
    }
    #products { display:grid; grid-template-columns:repeat(auto-fit, minmax(180px, 1fr)); gap:1rem; padding:1rem; }
    .card {
      background:var(--card);
      border-radius:1rem;
      overflow:hidden;
      box-shadow:0 10px 30px rgba(14,159,110,.08);
      display:flex;
      flex-direction:column;
      min-height:280px;
      border:1px solid rgba(47,158,68,.04);
    }
    .thumb {
      width:100%;
      aspect-ratio:4/3;
      background:#e2e8f0;
      background-size:cover;
      background-position:center;
    }
    .inner { padding:.8rem; flex:1; display:flex; flex-direction:column; gap:.4rem; }
    .name { font-weight:700; color:#064e3b; }
    .name.ar { direction:rtl; font-family: "Tahoma", system-ui, sans-serif; }
    .desc { font-size:.7rem; color:var(--muted); }
    .desc.ar { direction:rtl; }
    .price { color:var(--accent); font-weight:600; font-size:.8rem; }
    .price small { display:block; color:#4b5563; font-weight:400; font-size:.7rem; }
    .qty { font-size:.7rem; color:#475569; }
    .actions { display:flex; gap:.4rem; margin-top:auto; }
    .btn {
      flex:1;
      text-align:center;
      background:var(--accent);
      color:#fff;
      border:none;
      border-radius:.5rem;
      padding:.35rem .4rem;
      font-size:.7rem;
      text-decoration:none;
      display:inline-block;
    }
    .btn.outline {
      background:#ecfdf3;
      color:#166534;
      border:1px solid rgba(22,101,52,.4);
    }
    .empty { padding:1.5rem; text-align:center; color:#64748b; }
    .errorbar {
      background:#fef2f2; color:#991b1b; text-align:center; padding:.6rem .5rem; font-size:.75rem;
    }
    @media (min-width:700px){
      header { gap:1rem; }
      header h1 { font-size:1.1rem; }
    }
  </style>
</head>
<body>
  <div id="error" class="errorbar" style="display:none;"></div>
  <header id="topbar" dir="ltr">
    <h1 id="title">🍃 WhitePack Catalogue</h1>
    <input type="search" id="search" placeholder="Search..." />
    <select id="category">
      <option value="">All</option>
    </select>
    <button id="langBtn" data-lang="en">AR</button>
  </header>

  <div id="products"></div>
  <div id="empty" class="empty" style="display:none;">No products found.</div>

  <script>
    // CONFIG: your JSON source on GitHub Pages
    const DATA_URL = "https://yallawassel.github.io/whitepack_store/products.json";
    const RATE_KEY = "internal_catalogue_usd_to_lbp";
    let products = [];
    let currentLang = "en"; // en or ar

    // fetch data
    async function loadData(){
      try {
        const res = await fetch(DATA_URL + "?t=" + Date.now()); // prevent cache
        if(!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();
        products = Array.isArray(data) ? data : (data.products || []);
        hideError();
        buildCategoryFilter(products);
        render(products);
      } catch (err){
        showError(currentLang === "ar" ? "تعذر تحميل البيانات من GitHub. تأكد من أن الملف products.json موجود." : "Could not load data from GitHub. Make sure products.json exists.");
        document.getElementById("products").innerHTML = "";
        document.getElementById("empty").style.display = "block";
      }
    }

    function showError(msg){
      const e = document.getElementById("error");
      e.style.display = "block";
      e.textContent = msg;
    }
    function hideError(){
      const e = document.getElementById("error");
      e.style.display = "none";
    }

    function buildCategoryFilter(list){
      const catSel = document.getElementById("category");
      const cats = Array.from(new Set(list.map(p => (currentLang === "ar" ? p.category_ar : p.category)).filter(Boolean))).sort();
      catSel.innerHTML = `<option value="">${currentLang === "ar" ? "الكل" : "All"}</option>` + cats.map(c => `<option value="${c}">${c}</option>`).join("");
    }

    function getRate(){
      const r = localStorage.getItem(RATE_KEY);
      return r ? Number(r) : 90000;
    }

    function render(list){
      const box = document.getElementById("products");
      if(!list.length){
        box.innerHTML = "";
        document.getElementById("empty").style.display = "block";
        return;
      }
      document.getElementById("empty").style.display = "none";
      const rate = getRate();
      box.innerHTML = list.map(p => {
        const img = p.image ? `style="background-image:url('${p.image}');"` : "";
        const wa = p.whatsapp ? `https://wa.me/${p.whatsapp}?text=${encodeURIComponent((currentLang==="ar"?"مرحبا، اريد هذا المنتج: ":"Hello, I want to order: ") + (p.name || p.sku))}` : "#";
        const priceUSD = p.price ? Number(p.price) : null;
        const priceLBP = priceUSD ? Math.round(priceUSD * rate).toLocaleString("en-LB") : null;
        return `
          <div class="card">
            <div class="thumb" ${img}></div>
            <div class="inner">
              <div class="name ${currentLang==="ar"?"ar":""}">${currentLang==="ar" ? (p.name_ar || p.name || "(بدون اسم)") : (p.name || "(no name)")}</div>
              <div class="desc ${currentLang==="ar"?"ar":""}">${currentLang==="ar" ? (p.description_ar || "") : (p.description || "")}</div>
              <div class="price">
                ${priceUSD ? priceUSD + " USD" : ""}
                ${priceLBP ? `<small>${priceLBP} LBP</small>` : ""}
              </div>
              <div class="qty" style="${currentLang==="ar" ? "direction:rtl" : ""}">
                ${currentLang==="ar" ? "الكمية:" : "Qty:"} ${p.quantity || 0}
              </div>
              <div class="qty" style="font-size:.7rem; color:#94a3b8; ${currentLang==="ar" ? "direction:rtl" : ""}">
                ${currentLang==="ar" ? "الصنف:" : "Cat:"} ${currentLang==="ar" ? (p.category_ar || "-") : (p.category || "-")}
              </div>
              <div class="actions">
                <a class="btn" href="${wa}" target="_blank">${currentLang==="ar" ? "واتساب" : "WhatsApp"}</a>
                <button class="btn outline" onclick='alert("${currentLang==="ar" ? "الرمز: " : "SKU: "}${p.sku || ""}")'>${currentLang==="ar" ? "الرمز" : "SKU"}</button>
              </div>
            </div>
          </div>
        `;
      }).join("");
    }

    function filter(){
      const q = document.getElementById("search").value.toLowerCase().trim();
      const cat = document.getElementById("category").value;
      const filtered = products.filter(p => {
        const name = (currentLang==="ar" ? p.name_ar : p.name) || "";
        const category = (currentLang==="ar" ? p.category_ar : p.category) || "";
        const inSearch = !q || name.toLowerCase().includes(q) || (p.sku && p.sku.toLowerCase().includes(q)) || category.toLowerCase().includes(q);
        const inCat = !cat || category === cat;
        return inSearch && inCat;
      });
      render(filtered);
    }

    document.getElementById("search").addEventListener("input", filter);
    document.getElementById("category").addEventListener("change", filter);

    document.getElementById("langBtn").addEventListener("click", () => {
      currentLang = currentLang === "en" ? "ar" : "en";
      const header = document.getElementById("topbar");
      header.dir = currentLang === "ar" ? "rtl" : "ltr";
      document.getElementById("langBtn").textContent = currentLang === "en" ? "AR" : "EN";
      document.getElementById("title").textContent = currentLang === "en" ? "🍃 WhitePack Catalogue" : "🍃 كتالوج وايت باك";
      document.getElementById("search").placeholder = currentLang === "en" ? "Search..." : "بحث...";
      buildCategoryFilter(products);
      filter();
    });

    loadData();
  </script>
</body>
</html>
