<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>WhitePack — Online Catalogue</title>
<style>
:root {
  --bg: #f5fff8;
  --accent: #3b7a3a;
  --accent2: #6ecf6e;
  --muted: #4b6b4b;
  --card: #fff;
}
* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, Arial;
  background: var(--bg);
  color: #213;
  line-height: 1.35;
}
header {
  background: linear-gradient(90deg, #a6e8a6, #4ea84e);
  padding: 14px 16px;
  display: flex;
  align-items: center;
  gap: 12px;
  flex-wrap: wrap;
}
.logo {
  width: 56px;
  height: 44px;
  border-radius: 8px;
  background: #3b7a3a;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  color: #fff;
  font-size: 14px;
}
h1 { margin: 0; font-size: 20px; color: #1f401d; }
.topbar {
  margin-left: auto;
  display: flex;
  flex-direction: column;
  gap: 4px;
  align-items: flex-end;
  font-size: 13px;
  color: #133a12;
}
.topbar a { color: #133a12; text-decoration: none; font-weight: 600; }
.top-actions { display:flex; gap:6px; align-items:center; }

.lang-btn {
  border:none;
  background:#fff;
  color:#166534;
  border-radius:9999px;
  padding:2px 10px;
  font-size:12px;
  cursor:pointer;
  font-weight:600;
}

.container { padding: 16px; }
.controls {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  margin-bottom: 12px;
}
#search {
  flex: 1;
  padding: 10px;
  border-radius: 10px;
  border: 1px solid rgba(0,0,0,0.06);
  font-size: .9rem;
}
#filterCat {
  padding: 9px;
  border-radius: 8px;
  border: 1px solid rgba(0,0,0,0.06);
  font-size: .85rem;
}
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(190px, 1fr));
  gap: 14px;
}
.card {
  background: var(--card);
  border-radius: 12px;
  padding: 10px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.06);
  display: flex;
  flex-direction: column;
  gap: 6px;
  min-height: 240px;
  overflow: hidden;
}
.card-img {
  width: 100%;
  aspect-ratio: 1/1;
  background: #fff;
  border: 1px solid #e2e8f0;
  border-radius: 10px;
  overflow: hidden;
  display:flex;
  align-items:center;
  justify-content:center;
}
.card-img img {
  width:100%;
  height:100%;
  object-fit: cover; /* crop to square */
}
.card h3 { margin: 0; font-size: 15px; color: #2f5f2d; }
.card p { margin: 0; color: #4f6a4b; font-size: 12.5px; flex: 1; }
.card .meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 8px;
  margin-top:6px;
}
.price {
  font-weight:700;
  color:#2f5f2d;
  font-size:.85rem;
}
.price small {
  display:block;
  color:#557;
  font-weight:400;
  font-size:.65rem;
}
.btn {
  background: var(--card);
  border: 1px solid rgba(0,0,0,0.06);
  padding: 6px 10px;
  border-radius: 10px;
  color: var(--muted);
  font-weight: 600;
  cursor: pointer;
  font-size: 12px;
}
.btn.primary {
  background: linear-gradient(90deg, var(--accent2), var(--accent));
  color: #fff;
  border: none;
}
.footer {
  background: #d8f0d8;
  padding: 12px;
  text-align: center;
  font-size: 14px;
  color: #1e3a1e;
  margin-top: 18px;
  border-top: 1px solid rgba(0,0,0,0.03);
}
#adminFlag {
  display:none;
  font-size:13px;
  padding:4px 6px;
  border-radius:8px;
  background:#e8ffe8;
  color:#133a12;
  border:1px solid rgba(0,0,0,0.04)
}
#lastUpdated {
  font-size: 12px;
  color: #475569;
  margin-bottom: 10px;
}

/* admin gear */
#adminGear {
  position: fixed;
  right: 12px;
  bottom: 12px;
  width: 44px;
  height: 44px;
  border-radius: 50%;
  background: #ffffffaa;
  border: 1px solid rgba(0,0,0,0.06);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  opacity: 0.12;
  transition: opacity .18s, transform .12s;
  z-index: 9999;
}
#adminGear:hover { opacity: 1; transform: scale(1.05); }

#adminControls { display:none; margin-bottom:12px; }

.modal {
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(2,6,23,0.45);
  z-index: 10000;
}
.modal .panel {
  width: 96%;
  max-width: 540px;
  background: #fff;
  padding: 14px;
  border-radius: 10px;
  box-shadow: 0 8px 30px rgba(0,0,0,0.2);
}
@media(max-width:600px){
  .grid{grid-template-columns:repeat(auto-fill,minmax(140px,1fr))}
  header{flex-wrap:wrap}
  .topbar{align-items:flex-start}
}
</style>
</head>
<body>

<header id="topHeader" dir="ltr">
  <div class="logo">WP</div>
  <div>
    <h1 id="companyName">White Pack</h1>
    <div id="companySlogan" style="font-size:12px;color:#2b5a2b">Best Quality</div>
  </div>
  <div class="topbar">
    <div><strong id="waLabel">WhatsApp:</strong> <a id="waLink" href="https://wa.me/96181085811" target="_blank">+961 81 085 811</a></div>
    <div><strong id="emailLabel">Email:</strong> <a id="mailLink" href="mailto:whitepack.lb@hotmail.com">whitepack.lb@hotmail.com</a></div>
    <div><strong id="addrLabel">Address:</strong> <span id="companyAddress">(add in settings)</span></div>
    <div class="top-actions">
      <button id="langToggle" class="lang-btn">AR</button>
      <span id="adminFlag">ADMIN</span>
    </div>
  </div>
</header>

<main class="container">
  <div id="lastUpdated">Last updated: --</div>

  <div id="adminControls">
    <button class="btn primary" onclick="alert('Use admin.html to upload Excel and export products.json, then upload to GitHub.')">Admin info</button>
  </div>

  <div style="display:flex;gap:10px;align-items:center;justify-content:space-between;margin-bottom:12px">
    <input id="search" placeholder="Search products..." />
    <select id="filterCat">
      <option value="">All categories</option>
    </select>
  </div>

  <div id="grid" class="grid" aria-live="polite"></div>

  <div class="footer">
    <div id="footerText"><strong>Best Quality</strong> — WhatsApp: <a href="https://wa.me/96181085811" target="_blank">+961 81 085 811</a> • Email: <a href="mailto:whitepack.lb@hotmail.com">whitepack.lb@hotmail.com</a></div>
  </div>
</main>

<div id="adminGear" title="Admin (press Alt+Shift+W)">⚙️</div>

<div id="modal" class="modal" role="dialog" aria-modal="true">
  <div class="panel" id="modalPanel"></div>
</div>

<script>
// CONFIG
const DATA_URL = "https://yallawassel.github.io/whitepack_store/products.json";
const RATE_KEY = "internal_catalogue_usd_to_lbp";
const ADMIN_PW = "whitepack123";
let currentLang = "en";
let products = [];

async function loadProducts(){
  try{
    const res = await fetch(DATA_URL + "?t=" + Date.now());
    const data = await res.json();
    // assume it's an array
    products = Array.isArray(data) ? data : (data.products || []);
    setLastUpdated();
    buildCategories();
    render();
  }catch(err){
    document.getElementById("lastUpdated").textContent = currentLang==="ar"
      ? "تعذر تحميل المنتجات من GitHub"
      : "Could not load products from GitHub";
  }
}

function setLastUpdated(){
  const now = new Date();
  const formatted = now.getFullYear() + "-" +
    String(now.getMonth()+1).padStart(2,"0") + "-" +
    String(now.getDate()).padStart(2,"0") + " " +
    String(now.getHours()).padStart(2,"0") + ":" +
    String(now.getMinutes()).padStart(2,"0");
  document.getElementById("lastUpdated").textContent =
    (currentLang==="ar" ? "آخر تحديث: " : "Last updated: ") + formatted + " (GitHub)";
}

function getRate(){
  const r = localStorage.getItem(RATE_KEY);
  return r ? Number(r) : 90000;
}

function buildCategories(){
  const sel = document.getElementById("filterCat");
  const cats = Array.from(new Set(products.map(p => currentLang==="ar" ? p.category_ar : p.category).filter(Boolean))).sort();
  sel.innerHTML = `<option value="">${currentLang==="ar" ? "كل الاصناف" : "All categories"}</option>` + 
    cats.map(c => `<option value="${c}">${c}</option>`).join("");
}

function render(){
  const grid = document.getElementById("grid");
  const q = document.getElementById("search").value.toLowerCase().trim();
  const cat = document.getElementById("filterCat").value;
  const rate = getRate();

  grid.innerHTML = "";

  const filtered = products.filter(p => {
    const name = (currentLang==="ar" ? p.name_ar : p.name) || "";
    const category = (currentLang==="ar" ? p.category_ar : p.category) || "";
    const inSearch = !q || name.toLowerCase().includes(q) || (p.sku && p.sku.toLowerCase().includes(q));
    const inCat = !cat || category === cat;
    return inSearch && inCat;
  });

  filtered.forEach(p => {
    const priceUSD = p.price ? Number(p.price) : null;
    const priceLBP = priceUSD ? Math.round(priceUSD * rate).toLocaleString("en-LB") : null;
    const name = currentLang==="ar" ? (p.name_ar || p.name || "(بدون اسم)") : (p.name || "(no name)");
    const desc = currentLang==="ar" ? (p.description_ar || "") : (p.description || "");
    const catName = currentLang==="ar" ? (p.category_ar || "-") : (p.category || "-");
    const wa = p.whatsapp ? `https://wa.me/${p.whatsapp}?text=${encodeURIComponent((currentLang==="ar"?"مرحبا، أريد: ":"Hello, I want: ") + name)}` : "#";

    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <div class="card-img">
        <img src="${p.image || ''}" alt="${name}" onerror="this.style.display='none'">
      </div>
      <h3>${name}</h3>
      <p>${desc}</p>
      <div class="meta">
        <div class="price">
          ${priceUSD ? priceUSD + " USD" : ""}
          ${priceLBP ? `<small>${priceLBP} LBP</small>` : ""}
        </div>
        <button class="btn" onclick="window.open('${wa}', '_blank')">${currentLang==="ar" ? "واتساب" : "WhatsApp"}</button>
      </div>
      <div style="font-size:11px;color:#6b6b6b;margin-top:4px">${currentLang==="ar" ? "الصنف: " : "Category: "}${catName}</div>
    `;
    grid.appendChild(card);
  });

  if(!filtered.length){
    const div = document.createElement("div");
    div.textContent = currentLang==="ar" ? "لا يوجد منتجات" : "No products";
    div.style.color = "#64748b";
    grid.appendChild(div);
  }
}

document.getElementById("search").addEventListener("input", render);
document.getElementById("filterCat").addEventListener("change", render);

document.getElementById("langToggle").addEventListener("click", () => {
  currentLang = currentLang === "en" ? "ar" : "en";
  applyLang();
  buildCategories();
  render();
});

function applyLang(){
  const header = document.getElementById("topHeader");
  if(currentLang === "ar"){
    header.dir = "rtl";
    document.getElementById("langToggle").textContent = "EN";
    document.getElementById("search").placeholder = "بحث عن منتج...";
    document.getElementById("waLabel").textContent = "واتساب:";
    document.getElementById("emailLabel").textContent = "ايميل:";
    document.getElementById("addrLabel").textContent = "العنوان:";
    document.getElementById("companySlogan").textContent = "أفضل جودة";
    document.getElementById("lastUpdated").textContent = "آخر تحديث: —";
  } else {
    header.dir = "ltr";
    document.getElementById("langToggle").textContent = "AR";
    document.getElementById("search").placeholder = "Search products...";
    document.getElementById("waLabel").textContent = "WhatsApp:";
    document.getElementById("emailLabel").textContent = "Email:";
    document.getElementById("addrLabel").textContent = "Address:";
    document.getElementById("companySlogan").textContent = "Best Quality";
    document.getElementById("lastUpdated").textContent = "Last updated: —";
  }
  setLastUpdated();
}

// admin access (same password)
const adminGear = document.getElementById("adminGear");
const adminFlag = document.getElementById("adminFlag");
adminGear.addEventListener("click", () => {
  const pw = prompt(currentLang==="ar" ? "ادخل كلمة السر:" : "Enter admin password:");
  if(pw === ADMIN_PW){
    adminFlag.style.display = "inline-block";
    document.getElementById("adminControls").style.display = "block";
    alert(currentLang==="ar"
      ? "تم تفعيل لوحة التحكم. لتحميل المنتجات استخدم admin.html و ارفع ملف products.json إلى GitHub."
      : "Admin enabled. To update products use admin.html and upload products.json to GitHub.");
  } else {
    alert(currentLang==="ar" ? "كلمة السر غير صحيحة" : "Wrong password");
  }
});

// initial
applyLang();
loadProducts();
</script>
</body>
</html>
